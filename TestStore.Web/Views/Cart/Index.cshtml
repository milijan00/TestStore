@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<h1>Your cart</h1>
<section class="container mx-auto" id="content">

</section>
<section class=" container mx-auto"style="display:none;" id="totalPriceContainer">
    <article class="mx-2">
        <h3 class="mb-0">Total amount: <span id="total"></span>RSD</h3>
    </article>
    <article>
        <a href="#" class="btn btn-primary">Checkout</a>
    </article>
</section>

<script type="module">
    import {removeProduct,saveProductsToLocalStorage, increaseQuantityByOne, decreaseQuantityByOne, totalPrice} from "/js/manageProducts.js";
    $(document).ready(function(){
        loadProductsFromLocalStorage();
        function displayTotal(){
            total.innerHTML = totalPrice();
            totalPriceContainer.style.display = "flex";
        }
        function hideTotal(){
            totalPriceContainer.style.display = "none";
        }

        function loadProductsFromLocalStorage(){
            var products = JSON.parse(localStorage.getItem("products"));
            
            if(!products || products.length == 0){
                noProducts();
                hideTotal();
                return;
            }

            displayProducts(products);
            displayTotal();
            
            function noProducts(){
                $("#content").html(`<p>There are no products in the cart.</p>`);
            }

            function renderQuantityButtons(product){
                return `
                <div>
                <a href='#' class="btn btn-light decrease" data-id="${product.id}">&minus;</a> 
                <span>${product.quantity}</span>
                <a href='#' class="btn btn-light increase" data-id="${product.id}">&plus;</a> 
                </div> 
                `;
            }
            function displayProducts(products){
                let html = `
        <table class="table table-stripped">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Remove</th>
                </tr>
            </thead>
            <tbody>
                `;
                for(let p of  products){
                    html += `
                    <tr>
                        <td style="width:5%;"><img src='/images/${p.image}' alt='product' class='img-fluid'/></td> 
                        <td >${p.price} RSD</td> 
                        <td>${renderQuantityButtons(p)}</td> 
                        <td><a href='#' class='btn btn-danger remove-product' data-id='${p.id}'>Remove</a></td> 
                    </tr> 
                    `;
                }
                html += `
            </tbody>
        </table>
                `;
                $("#content").html(html);

                $(".remove-product").click(function(e){
                    e.preventDefault();
                    const id = this.getAttribute("data-id");
                    removeProduct(id);
                    loadProductsFromLocalStorage();
                });

                $(".decrease").click(function(e){
                    e.preventDefault();
                    const id = this.getAttribute("data-id");
                    decreaseQuantityByOne({id : id});
                    loadProductsFromLocalStorage();
                });

                $(".increase").click(function(e){
                    e.preventDefault();
                    const id = this.getAttribute("data-id");
                    increaseQuantityByOne({id : id});
                    loadProductsFromLocalStorage();
                });


            }
        }
    });
</script>
